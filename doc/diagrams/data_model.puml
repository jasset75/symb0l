@startuml DataModel
skinparam linetype ortho

entity "Country" as country {
  *country_code : TEXT <<PK>>
  --
  *name : TEXT
}

entity "Market" as market {
  *market_id : INTEGER <<PK>>
  --
  *mic_code : TEXT <<UQ>>
  ticker_prefix : TEXT
  *name : TEXT
  title : TEXT
  *country_code : TEXT <<FK>>
  timezone : TEXT
}

entity "Instrument" as instrument {
  *instrument_id : INTEGER <<PK>>
  --
  isin : TEXT <<UQ, nullable>>
  *name : TEXT
  *instrument_type : TEXT
}

entity "Listing" as listing {
  *listing_id : INTEGER <<PK>>
  --
  *instrument_id : INTEGER <<FK>>
  *market_id : INTEGER <<FK>>
  *symbol_code : TEXT
  display_ticker : TEXT
  currency_id : TEXT <<FK>>
}

entity "Currency" as currency {
  *currency_id : TEXT <<PK>>
  --
  *name : TEXT
  *code3 : TEXT
  *code2 : TEXT
  *currency_symbol : TEXT
  *decimal_digits : INTEGER
}

country ||..|{ market
market ||..|{ listing
instrument ||..|{ listing
currency ||..|{ listing

note right of country
  ISO 3166-1 alpha-2
  (US, ES, FR, JP, etc.)
end note

note right of market
  Dual-code system:
  • mic_code: ISO 10383 (XNAS)
  • ticker_prefix: Google Finance (NASDAQ)
end note

note right of instrument
  ISIN nullable for
  forex and crypto
end note

@enduml
